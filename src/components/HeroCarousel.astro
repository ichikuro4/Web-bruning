---
interface Slide {
  title: string;
  subtitle: string;
  description: string;
  image: string;
  cta?: {
    text: string;
    link: string;
  };
}

interface Props {
  slides: Slide[];
  autoplayInterval?: number;
}

const { slides, autoplayInterval = 5000 } = Astro.props;
---

<div class="hero-carousel relative w-full min-h-screen overflow-hidden bg-slate-900">
  <!-- Slides Container -->
  <div class="slides-wrapper relative w-full min-h-screen">
    {slides.map((slide, index) => (
      <div 
        class={`slide absolute inset-0 min-h-screen transition-opacity duration-1000 ${index === 0 ? 'opacity-100 z-10' : 'opacity-0 z-0'}`}
        data-slide={index}
      >
        <!-- Background Image with Overlay -->
        <div class="absolute inset-0">
          <img 
            src={slide.image} 
            alt={slide.title}
            class="w-full h-full object-cover"
            loading="eager"
          />
          <div class="absolute inset-0 bg-gradient-to-br from-colegio-blue/70 via-colegio-blue/60 to-colegio-blue/70"></div>
          <div class="absolute inset-0 bg-black/25"></div>
        </div>

        <!-- Animated gradient overlay -->
        <div class="absolute inset-0 bg-gradient-to-r from-colegio-yellow/10 via-transparent to-purple-500/10 animate-gradient"></div>

        <!-- Floating shapes -->
        <div class="absolute inset-0 overflow-hidden pointer-events-none">
          <div class="absolute top-20 left-10 w-72 h-72 bg-colegio-yellow/10 rounded-full blur-3xl animate-float"></div>
          <div class="absolute bottom-20 right-10 w-96 h-96 bg-purple-500/10 rounded-full blur-3xl animate-float-delayed"></div>
        </div>

        <!-- Content -->
        <div class="relative z-20 flex items-center justify-center min-h-screen px-4">
          <div class="text-center max-w-5xl mt-20">
            <div class="inline-block mb-6 px-6 py-2 bg-colegio-yellow/20 backdrop-blur-sm border border-colegio-yellow/30 rounded-full text-colegio-yellow font-semibold animate-fade-in">
              {slide.subtitle}
            </div>
            
            <h1 class="text-5xl md:text-7xl lg:text-8xl font-black mb-6 text-white drop-shadow-2xl animate-slide-up">
              <Fragment set:html={slide.title} />
            </h1>
            
            <p class="text-xl md:text-2xl mb-10 font-light text-blue-100 max-w-3xl mx-auto animate-slide-up-delay leading-relaxed">
              {slide.description}
            </p>
            
            {slide.cta && (
              <div class="flex flex-col sm:flex-row gap-4 justify-center animate-slide-up-delay-2">
                <a 
                  href={slide.cta.link} 
                  class="group bg-gradient-to-r from-colegio-yellow to-yellow-400 hover:from-yellow-400 hover:to-colegio-yellow text-colegio-blue font-bold py-4 px-10 rounded-full transition-all duration-300 hover:scale-110 hover:shadow-2xl shadow-xl flex items-center justify-center gap-2"
                >
                  <span>{slide.cta.text}</span>
                  <svg class="w-5 h-5 group-hover:translate-x-1 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7l5 5m0 0l-5 5m5-5H6"></path>
                  </svg>
                </a>
                
                <a 
                  href="https://tu-moodle.com" 
                  target="_blank" 
                  class="group bg-white/10 backdrop-blur-md border-2 border-white/30 hover:bg-white/20 hover:border-white/50 text-white font-bold py-4 px-10 rounded-full transition-all duration-300 hover:scale-105 flex items-center justify-center gap-2"
                >
                  <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path d="M10.394 2.827a1 1 0 00-.788 0l-7 3a1 1 0 000 1.848l.788.338v3.656a1 1 0 00.553.894l4.5 2.25a1 1 0 00.894 0l4.5-2.25a1 1 0 00.553-.894V8.013l.788-.338a1 1 0 000-1.848l-7-3zM7.333 11.5l3.277 1.639 3.277-1.639V8.834l-3.277 1.405a1 1 0 01-.788 0L7.333 8.834V11.5z" />
                  </svg>
                  <span>Aula Virtual</span>
                </a>
              </div>
            )}
          </div>
        </div>
      </div>
    ))}
  </div>

  <!-- Navigation Arrows -->
  <button 
    class="carousel-btn prev absolute left-4 md:left-8 top-1/2 -translate-y-1/2 z-30 bg-white/10 hover:bg-white/20 backdrop-blur-md border border-white/20 rounded-full p-3 md:p-4 transition-all duration-300 hover:scale-110 group"
    aria-label="Anterior"
  >
    <svg class="w-6 h-6 text-white group-hover:-translate-x-1 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
    </svg>
  </button>

  <button 
    class="carousel-btn next absolute right-4 md:right-8 top-1/2 -translate-y-1/2 z-30 bg-white/10 hover:bg-white/20 backdrop-blur-md border border-white/20 rounded-full p-3 md:p-4 transition-all duration-300 hover:scale-110 group"
    aria-label="Siguiente"
  >
    <svg class="w-6 h-6 text-white group-hover:translate-x-1 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
    </svg>
  </button>

  <!-- Indicators -->
  <div class="absolute bottom-8 left-1/2 -translate-x-1/2 z-30 flex gap-3">
    {slides.map((_, index) => (
      <button
        class={`indicator w-3 h-3 rounded-full transition-all duration-300 ${index === 0 ? 'bg-colegio-yellow w-8' : 'bg-white/40 hover:bg-white/60'}`}
        data-index={index}
        aria-label={`Ir al slide ${index + 1}`}
      ></button>
    ))}
  </div>

  <!-- Scroll Indicator -->
  <div class="absolute bottom-20 left-1/2 -translate-x-1/2 z-30 animate-bounce">
    <svg class="w-6 h-6 text-white/60" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 14l-7 7m0 0l-7-7m7 7V3"></path>
    </svg>
  </div>
</div>

<style>
  @keyframes gradient {
    0%, 100% { transform: translateX(0) translateY(0); }
    50% { transform: translateX(100px) translateY(100px); }
  }

  @keyframes float {
    0%, 100% { transform: translateY(0) scale(1); }
    50% { transform: translateY(-30px) scale(1.1); }
  }

  @keyframes float-delayed {
    0%, 100% { transform: translateY(0) scale(1); }
    50% { transform: translateY(-40px) scale(1.05); }
  }

  @keyframes fadeIn {
    from { opacity: 0; transform: translateY(20px); }
    to { opacity: 1; transform: translateY(0); }
  }

  @keyframes slideUp {
    from { opacity: 0; transform: translateY(40px); }
    to { opacity: 1; transform: translateY(0); }
  }

  .animate-gradient { animation: gradient 20s ease infinite; }
  .animate-float { animation: float 8s ease-in-out infinite; }
  .animate-float-delayed { animation: float-delayed 10s ease-in-out infinite; }
  .animate-fade-in { animation: fadeIn 1s ease-out; }
  .animate-slide-up { animation: slideUp 0.8s ease-out; }
  .animate-slide-up-delay { animation: slideUp 0.8s ease-out 0.2s backwards; }
  .animate-slide-up-delay-2 { animation: slideUp 0.8s ease-out 0.4s backwards; }

  .carousel-btn {
    opacity: 0;
    transition: opacity 0.3s;
  }

  .hero-carousel:hover .carousel-btn {
    opacity: 1;
  }
</style>

<script define:vars={{ autoplayInterval }}>
  let currentSlide = 0;
  let autoplayTimer = null;
  let isPaused = false;
  let pauseTimer = null;

  const slides = document.querySelectorAll('.slide');
  const indicators = document.querySelectorAll('.indicator');
  const prevBtn = document.querySelector('.carousel-btn.prev');
  const nextBtn = document.querySelector('.carousel-btn.next');
  const carousel = document.querySelector('.hero-carousel');

  function showSlide(index) {
    slides.forEach((slide, i) => {
      if (i === index) {
        slide.classList.add('opacity-100', 'z-10');
        slide.classList.remove('opacity-0', 'z-0');
      } else {
        slide.classList.remove('opacity-100', 'z-10');
        slide.classList.add('opacity-0', 'z-0');
      }
    });

    indicators.forEach((indicator, i) => {
      if (i === index) {
        indicator.classList.add('bg-colegio-yellow', 'w-8');
        indicator.classList.remove('bg-white/40', 'w-3');
      } else {
        indicator.classList.remove('bg-colegio-yellow', 'w-8');
        indicator.classList.add('bg-white/40', 'w-3');
      }
    });

    currentSlide = index;
  }

  function nextSlide() {
    const next = (currentSlide + 1) % slides.length;
    showSlide(next);
  }

  function prevSlide() {
    const prev = (currentSlide - 1 + slides.length) % slides.length;
    showSlide(prev);
  }

  function stopAutoplay() {
    if (autoplayTimer) {
      clearInterval(autoplayTimer);
      autoplayTimer = null;
    }
  }

  function startAutoplay() {
    stopAutoplay(); // Siempre limpia el timer anterior antes de crear uno nuevo
    if (!isPaused) {
      autoplayTimer = setInterval(nextSlide, autoplayInterval);
    }
  }

  function pauseAutoplayTemporarily(duration = 10000) {
    isPaused = true;
    stopAutoplay();
    
    // Limpiar timeout anterior si existe
    if (pauseTimer) {
      clearTimeout(pauseTimer);
    }
    
    pauseTimer = setTimeout(() => {
      isPaused = false;
      startAutoplay();
      pauseTimer = null;
    }, duration);
  }

  // Event Listeners
  prevBtn?.addEventListener('click', () => {
    prevSlide();
    pauseAutoplayTemporarily();
  });

  nextBtn?.addEventListener('click', () => {
    nextSlide();
    pauseAutoplayTemporarily();
  });

  indicators.forEach((indicator, index) => {
    indicator.addEventListener('click', () => {
      showSlide(index);
      pauseAutoplayTemporarily();
    });
  });

  // Pause on hover
  carousel?.addEventListener('mouseenter', () => {
    stopAutoplay();
  });

  carousel?.addEventListener('mouseleave', () => {
    if (!isPaused) {
      startAutoplay();
    }
  });

  // Start autoplay
  startAutoplay();

  // Cleanup on page unload
  window.addEventListener('beforeunload', () => {
    stopAutoplay();
    if (pauseTimer) clearTimeout(pauseTimer);
  });
</script>
